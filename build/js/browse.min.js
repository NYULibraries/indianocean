/*! indianocean-site 2018-08-30 */
YUI().use("node","event","handlebars","jsonp","router","gallery-paginator","anim",function(a){"use strict";function b(){var a=d("page"),b=d("sort"),c=a?a:1,e=n.getPath()+"?page="+c;return b&&(e=e+"&sort="+b),e}function c(){var a=d("sort"),b=n.getPath();return a&&(b=b+"&sort="+a),b}function d(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function e(){a.all("#browse-select option").each(function(a){var b=a.get("text");b=b.replace("Sorting by","Sort by"),a.set("text",b)});var b=a.one("#browse-select option:checked").get("text");b=b.replace("Sort by","Sorting by"),a.one("#browse-select option:checked").set("text",b),n.replace(c())}function f(c,d){var e=d.container.getData(),f=e.requesterror;f?(f=parseInt(f,10)+1,d.container.setAttribute("data-requesterror",f)):(d.container.setAttribute("data-requesterror",1),f=1),3>f?n.replace(b()):a.log("onFailure: there was a problem with this request")}function g(){f()}function h(a){this.setPage(a.page,!0),this.setRowsPerPage(a.rowsPerPage,!0),this.setTotalRecords(a.totalRecords,!0),n.save(n.getPath()+"?page="+a.page)}function i(b,c,d){a.one("#paginator").empty();var e={totalRecords:c,rowsPerPage:d,initialPage:b,template:"{FirstPageLink} {PageLinks} {NextPageLink}"},f=new a.Paginator(e);f.on("changeRequest",h),c>d&&f.render("#paginator")}function j(b,c){try{var d=c.container,e=a.one(".resultsnum"),f=c.page?c.page:1,g=parseInt(b.response.numFound,10),h=e.one(".numfound"),j=parseInt(b.response.start,10),k=1>j?1:j+1,l=e.one(".start"),n=e.one(".docslength"),o=parseInt(b.response.docs.length,10),p=a.one("body").getAttribute("data-app"),q=c.rows;i(f,g,q),d.setAttribute("data-numFound",g),d.setAttribute("data-start",j),d.setAttribute("data-docsLength",o),l.set("innerHTML",k),n.set("innerHTML",j+o),h.set("innerHTML",g),d.append(m({items:b.response.docs,app:{appRoot:p}})),c.container.setAttribute("data-requesterror",0),a.one("body").removeClass("io-loading")}catch(r){}}function k(b){var c=0,d=0,e=a.one("#browse-select :checked"),h=e.get("value"),i=e.getAttribute("data-sort-dir"),k=b.container.getData(),l=a.one("body").getAttribute("data-discoUrl"),m=k.fl?k.fl:"*",n=k.rows?k.rows:10,o=[];a.one("body").addClass("io-loading");for(var p in k)k.hasOwnProperty(p)&&p.match("fq-")&&o.push(p.replace("fq-","")+":"+k[p]);b.page&&(d=parseInt(b.page,10)),b.start&&(c=parseInt(b.start,10)),b.rows&&(n=parseInt(b.rows,10)),l=l+"?wt=json&json.wrf=callback={callback}&q=*&fl="+m+"&fq="+o.join("&fq=")+"&rows="+n+"&start="+c+"&sort="+h+"%20"+i,b.container.empty(),a.jsonp(l,{on:{success:j,failure:f,timeout:g},args:b,timeout:3e3})}var l=a.one("#items").getHTML(),m=a.Handlebars.compile(l),n=new a.Router;n.route(n.getPath(),function(b){var c=a.one('[data-name="items"]'),d=c.getData(),e=b.query.rows?b.query.rows:d.rows?d.rows:10,f=b.query.sort?b.query.sort:d.sort?d.sort:a.one("#browse-select").get("value"),g=b.query.page?parseInt(b.query.page,10):0,h=0;h=1>=g?0:g*e-e,k({container:c,start:h,page:g,rows:e,sort:f})}),n.replace(b()),a.one("body").delegate("change",e,"#browse-select"),a.one("body").delegate("change",e,"#filter-year"),a.one("body").delegate("change",e,"#filter-publisher")});